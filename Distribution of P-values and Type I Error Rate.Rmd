---
title: "Distribution of P-values and Type I Error Rate"
author: "Peiran Zhang"
date: "11/24/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r}
library(car)
library(RNOmni)
library(VGAM)
library(GeneralizedHyperbolic)
library(lsr)
library(lmPerm)
library(pwr)
library(coin)
library(Deducer)

INT_function = function(x, n, k) { 
  output = 0
  ranks = rank(x)
  for (i in 1:n) {
    output[i] = probitlink((ranks[i] - k)/(n + 1 - 2*k))
  }
  return(output)
}
```

## Two Sample Test

## Normal Distribution
```{r}
# Use the given matrix to fit the data generated from normal distribution. Using 0.05 as significance level and test for sample size 50 and 100 respectively.

simulation = 1000 # repeat the simulation 1000 times
k = 0.4
n = 50
X1 = c(rep(1, n/2), rep(0, n/2))
X2 = c(rep(0, n/2), rep(1, n/2))
A = matrix(c(X1, X2), nrow = n, ncol=2) # create the matrix
p_original = vector(length = simulation)
error_original = NA
p_transformed = vector(length = simulation)
error_transformed = NA

for(i in 1 : simulation){
  original = rnorm(n)
  fit_original = lm(formula = original ~ A) # linear regression model
  p_original[i] = summary(fit_original)$coefficients[2,4] # p-value
  if (p_original[i] < 0.05) {
    error_original[i] = 1 # mark the positions of errors
  }
  transformed = INT_function(original, n, k) # transform the data and repeat the above process
  fit_transformed = lm(formula = transformed ~ A)
  p_transformed[i] = summary(fit_transformed)$coefficients[2,4]
  if (p_transformed[i] < 0.05) {
    error_transformed[i] = 1
  }
}
table(error_original) # count for errors in the test for original samples
table(error_transformed) # count for errors in the test for transformed samples
hist(p_original, main = "Distribution of p-values for Original Data with Sample Size 50")
hist(p_transformed, main = "Distribution of p-values for Transformed Data with Sample Size 50") 
```

```{r}
simulation = 1000
n = 100 # change sample size and repeat the above process
X1 = c(rep(1, n/2), rep(0, n/2))
X2 = c(rep(0, n/2), rep(1, n/2))
A = matrix(c(X1, X2), nrow = n, ncol=2) 
p_original = vector(length = simulation)
error_original = NA
p_transformed = vector(length = simulation)
error_transformed = NA

for(i in 1 : simulation){
  original = rnorm(n)
  fit_original = lm(formula = original ~ A) 
  p_original[i] = summary(fit_original)$coefficients[2,4] 
  if (p_original[i] < 0.05) {
    error_original[i] = 1
  }
  transformed = INT_function(original, n, k) 
  fit_transformed = lm(formula = transformed ~ A)
  p_transformed[i] = summary(fit_transformed)$coefficients[2,4]
  if (p_transformed[i] < 0.05) {
    error_transformed[i] = 1
  }
}
table(error_original) 
table(error_transformed) 
hist(p_original, main = "Distribution of p-values for Original Data with Sample Size 100") 
hist(p_transformed, main = "Distribution of p-values for Transformed Data with Sample Size 100")
```

## Exponential Distribution
```{r}
# Use the given matrix to fit the data generated from exponential distribution. Using 0.05 as significance level and test for sample size 50 and 100 respectively.

simulation = 1000
k = 0.4
n = 50
X1 = c(rep(1, n/2), rep(0, n/2))
X2 = c(rep(0, n/2), rep(1, n/2))
A = matrix(c(X1, X2), nrow = n, ncol=2) 
p_original = vector(length = simulation)
error_original = NA
p_transformed = vector(length = simulation)
error_transformed = NA

for(i in 1 : simulation){
  original = rexp(n)
  fit_original = lm(formula = original ~ A) 
  p_original[i] = summary(fit_original)$coefficients[2,4] 
  if (p_original[i] < 0.05) {
    error_original[i] = 1 
  }
  transformed = INT_function(original, n, k) 
  fit_transformed = lm(formula = transformed ~ A)
  p_transformed[i] = summary(fit_transformed)$coefficients[2,4]
  if (p_transformed[i] < 0.05) {
    error_transformed[i] = 1
  }
}
table(error_original) 
table(error_transformed) 
hist(p_original, main = "Distribution of p-values for Original Data with Sample Size 50")
hist(p_transformed, main = "Distribution of p-values for Transformed Data with Sample Size 50") 
```

```{r}
simulation = 1000
n = 100 # change sample size and repeat the above process
X1 = c(rep(1, n/2), rep(0, n/2))
X2 = c(rep(0, n/2), rep(1, n/2))
A = matrix(c(X1, X2), nrow = n, ncol=2) 
p_original = vector(length = simulation)
error_original = NA
p_transformed = vector(length = simulation)
error_transformed = NA

for(i in 1 : simulation){
  original = rexp(n)
  fit_original = lm(formula = original ~ A) 
  p_original[i] = summary(fit_original)$coefficients[2,4] 
  if (p_original[i] < 0.05) {
    error_original[i] = 1
  }
  transformed = INT_function(original, n, k) 
  fit_transformed = lm(formula = transformed ~ A)
  p_transformed[i] = summary(fit_transformed)$coefficients[2,4]
  if (p_transformed[i] < 0.05) {
    error_transformed[i] = 1
  }
}
table(error_original) 
table(error_transformed) 
hist(p_original, main = "Distribution of p-values for Original Data with Sample Size 100") 
hist(p_transformed, main = "Distribution of p-values for Transformed Data with Sample Size 100")
```

## Chi-square Distribution
```{r}
# Use the given matrix to fit the data generated from Chi-square distribution. Using 0.05 as significance level and test for sample size 50 and 100 respectively.

simulation = 1000 
k = 0.4
n = 50
X1 = c(rep(1, n/2), rep(0, n/2))
X2 = c(rep(0, n/2), rep(1, n/2))
A = matrix(c(X1, X2), nrow = n, ncol=2) 
p_original = vector(length = simulation)
error_original = NA
p_transformed = vector(length = simulation)
error_transformed = NA

for(i in 1 : simulation){
  original = rchisq(n, df = 1)
  fit_original = lm(formula = original ~ A) 
  p_original[i] = summary(fit_original)$coefficients[2,4] 
  if (p_original[i] < 0.05) {
    error_original[i] = 1 
  }
  transformed = INT_function(original, n, k)
  fit_transformed = lm(formula = transformed ~ A)
  p_transformed[i] = summary(fit_transformed)$coefficients[2,4]
  if (p_transformed[i] < 0.05) {
    error_transformed[i] = 1
  }
}
table(error_original)
table(error_transformed)
hist(p_original, main = "Distribution of p-values for Original Data with Sample Size 50")
hist(p_transformed, main = "Distribution of p-values for Transformed Data with Sample Size 50") 
```

```{r}
simulation = 1000
n = 100 # change sample size and repeat the above process
X1 = c(rep(1, n/2), rep(0, n/2))
X2 = c(rep(0, n/2), rep(1, n/2))
A = matrix(c(X1, X2), nrow = n, ncol=2) 
p_original = vector(length = simulation)
error_original = NA
p_transformed = vector(length = simulation)
error_transformed = NA

for(i in 1 : simulation){
  original = rchisq(n, df = 1)
  fit_original = lm(formula = original ~ A) 
  p_original[i] = summary(fit_original)$coefficients[2,4] 
  if (p_original[i] < 0.05) {
    error_original[i] = 1
  }
  transformed = INT_function(original, n, k) 
  fit_transformed = lm(formula = transformed ~ A)
  p_transformed[i] = summary(fit_transformed)$coefficients[2,4]
  if (p_transformed[i] < 0.05) {
    error_transformed[i] = 1
  }
}
table(error_original) 
table(error_transformed) 
hist(p_original, main = "Distribution of p-values for Original Data with Sample Size 100") 
hist(p_transformed, main = "Distribution of p-values for Transformed Data with Sample Size 100")
```




## Other Heavy Tailed Distributions

## LaPlace Distribution
### Use the given matrix to fit the data generated from LaPlace distribution. Using 0.05, 0.01, and 0.001 as significance levels and test for sample size 20, 50, and 100 respectively.
```{r}
# n = 20

simulation = 1000 
k = 0.4
n = 20
X1 = c(rep(1, n/2), rep(0, n/2))
X2 = c(rep(0, n/2), rep(1, n/2))
A = matrix(c(X1, X2), nrow = n, ncol=2) 
p_original = vector(length = simulation)
error_original_005 = NA
error_original_001 = NA
error_original_0001 = NA
p_transformed = vector(length = simulation)
error_transformed_005 = NA
error_transformed_001 = NA
error_transformed_0001 = NA

for(i in 1 : simulation){
  param = c(1, 1, 3)
  original = rskewlap(n, param = param)
  fit_original = lm(formula = original ~ A) 
  p_original[i] = summary(fit_original)$coefficients[2,4]
  if (p_original[i] < 0.05) {
    error_original_005[i] = 1
  }
  if (p_original[i] < 0.01) {
    error_original_001[i] = 1
  }
  if (p_original[i] < 0.001) {
    error_original_0001[i] = 1
  }
  transformed = INT_function(original, n, k)
  fit_transformed = lm(formula = transformed ~ A)
  p_transformed[i] = summary(fit_transformed)$coefficients[2,4]
  if (p_transformed[i] < 0.05) {
    error_transformed_005[i] = 1
  }
  if (p_transformed[i] < 0.01) {
    error_transformed_001[i] = 1
  }
  if (p_transformed[i] < 0.001) {
    error_transformed_0001[i] = 1
  }
}
table(error_original_005)
table(error_original_001)
table(error_original_0001)
table(error_transformed_005)
table(error_transformed_001)
table(error_transformed_0001)
hist(p_original, main = "Distribution of p-values for Original Data with Sample Size 20")
hist(p_transformed, main = "Distribution of p-values for Transformed Data with Sample Size 20") 
```

```{r}
# n = 50

simulation = 1000 
k = 0.4
n = 50
X1 = c(rep(1, n/2), rep(0, n/2))
X2 = c(rep(0, n/2), rep(1, n/2))
A = matrix(c(X1, X2), nrow = n, ncol=2) 
p_original = vector(length = simulation)
error_original_005 = NA
error_original_001 = NA
error_original_0001 = NA
p_transformed = vector(length = simulation)
error_transformed_005 = NA
error_transformed_001 = NA
error_transformed_0001 = NA

for(i in 1 : simulation){
  param = c(1, 1, 3)
  original = rskewlap(n, param = param)
  fit_original = lm(formula = original ~ A) 
  p_original[i] = summary(fit_original)$coefficients[2,4]
  if (p_original[i] < 0.05) {
    error_original_005[i] = 1
  }
  if (p_original[i] < 0.01) {
    error_original_001[i] = 1
  }
  if (p_original[i] < 0.001) {
    error_original_0001[i] = 1
  }
  transformed = INT_function(original, n, k)
  fit_transformed = lm(formula = transformed ~ A)
  p_transformed[i] = summary(fit_transformed)$coefficients[2,4]
  if (p_transformed[i] < 0.05) {
    error_transformed_005[i] = 1
  }
  if (p_transformed[i] < 0.01) {
    error_transformed_001[i] = 1
  }
  if (p_transformed[i] < 0.001) {
    error_transformed_0001[i] = 1
  }
}
table(error_original_005)
table(error_original_001)
table(error_original_0001)
table(error_transformed_005)
table(error_transformed_001)
table(error_transformed_0001)
hist(p_original, main = "Distribution of p-values for Original Data with Sample Size 50")
hist(p_transformed, main = "Distribution of p-values for Transformed Data with Sample Size 50") 
```

```{r}
# n = 100

simulation = 1000 
k = 0.4
n = 100
X1 = c(rep(1, n/2), rep(0, n/2))
X2 = c(rep(0, n/2), rep(1, n/2))
A = matrix(c(X1, X2), nrow = n, ncol=2) 
p_original = vector(length = simulation)
error_original_005 = NA
error_original_001 = NA
error_original_0001 = NA
p_transformed = vector(length = simulation)
error_transformed_005 = NA
error_transformed_001 = NA
error_transformed_0001 = NA

for(i in 1 : simulation){
  param = c(1, 1, 3)
  original = rskewlap(n, param = param)
  fit_original = lm(formula = original ~ A) 
  p_original[i] = summary(fit_original)$coefficients[2,4]
  if (p_original[i] < 0.05) {
    error_original_005[i] = 1
  }
  if (p_original[i] < 0.01) {
    error_original_001[i] = 1
  }
  if (p_original[i] < 0.001) {
    error_original_0001[i] = 1
  }
  transformed = INT_function(original, n, k)
  fit_transformed = lm(formula = transformed ~ A)
  p_transformed[i] = summary(fit_transformed)$coefficients[2,4]
  if (p_transformed[i] < 0.05) {
    error_transformed_005[i] = 1
  }
  if (p_transformed[i] < 0.01) {
    error_transformed_001[i] = 1
  }
  if (p_transformed[i] < 0.001) {
    error_transformed_0001[i] = 1
  }
}
table(error_original_005)
table(error_original_001)
table(error_original_0001)
table(error_transformed_005)
table(error_transformed_001)
table(error_transformed_0001)
hist(p_original, main = "Distribution of p-values for Original Data with Sample Size 100")
hist(p_transformed, main = "Distribution of p-values for Transformed Data with Sample Size 100") 
```

## Weibull Distribution
### Use the given matrix to fit the data generated from Weibull distribution. Using 0.05, 0.01, and 0.001 as significance levels and test for sample size 20, 50, and 100 respectively.
```{r}
# n = 20

simulation = 1000 
k = 0.4
n = 20
X1 = c(rep(1, n/2), rep(0, n/2))
X2 = c(rep(0, n/2), rep(1, n/2))
A = matrix(c(X1, X2), nrow = n, ncol=2) 
p_original = vector(length = simulation)
error_original_005 = NA
error_original_001 = NA
error_original_0001 = NA
p_transformed = vector(length = simulation)
error_transformed_005 = NA
error_transformed_001 = NA
error_transformed_0001 = NA

for(i in 1 : simulation){
  original = rweibull(n, shape = 1, scale = 0.5)
  fit_original = lm(formula = original ~ A) 
  p_original[i] = summary(fit_original)$coefficients[2,4]
  if (p_original[i] < 0.05) {
    error_original_005[i] = 1
  }
  if (p_original[i] < 0.01) {
    error_original_001[i] = 1
  }
  if (p_original[i] < 0.001) {
    error_original_0001[i] = 1
  }
  transformed = INT_function(original, n, k)
  fit_transformed = lm(formula = transformed ~ A)
  p_transformed[i] = summary(fit_transformed)$coefficients[2,4]
  if (p_transformed[i] < 0.05) {
    error_transformed_005[i] = 1
  }
  if (p_transformed[i] < 0.01) {
    error_transformed_001[i] = 1
  }
  if (p_transformed[i] < 0.001) {
    error_transformed_0001[i] = 1
  }
}
table(error_original_005)
table(error_original_001)
table(error_original_0001)
table(error_transformed_005)
table(error_transformed_001)
table(error_transformed_0001)
hist(p_original, main = "Distribution of p-values for Original Data with Sample Size 20")
hist(p_transformed, main = "Distribution of p-values for Transformed Data with Sample Size 20") 
```

```{r}
# n = 50

simulation = 1000 
k = 0.4
n = 50
X1 = c(rep(1, n/2), rep(0, n/2))
X2 = c(rep(0, n/2), rep(1, n/2))
A = matrix(c(X1, X2), nrow = n, ncol=2) 
p_original = vector(length = simulation)
error_original_005 = NA
error_original_001 = NA
error_original_0001 = NA
p_transformed = vector(length = simulation)
error_transformed_005 = NA
error_transformed_001 = NA
error_transformed_0001 = NA

for(i in 1 : simulation){
  original = rweibull(n, shape = 1, scale = 0.5)
  fit_original = lm(formula = original ~ A) 
  p_original[i] = summary(fit_original)$coefficients[2,4]
  if (p_original[i] < 0.05) {
    error_original_005[i] = 1
  }
  if (p_original[i] < 0.01) {
    error_original_001[i] = 1
  }
  if (p_original[i] < 0.001) {
    error_original_0001[i] = 1
  }
  transformed = INT_function(original, n, k)
  fit_transformed = lm(formula = transformed ~ A)
  p_transformed[i] = summary(fit_transformed)$coefficients[2,4]
  if (p_transformed[i] < 0.05) {
    error_transformed_005[i] = 1
  }
  if (p_transformed[i] < 0.01) {
    error_transformed_001[i] = 1
  }
  if (p_transformed[i] < 0.001) {
    error_transformed_0001[i] = 1
  }
}
table(error_original_005)
table(error_original_001)
table(error_original_0001)
table(error_transformed_005)
table(error_transformed_001)
table(error_transformed_0001)
hist(p_original, main = "Distribution of p-values for Original Data with Sample Size 50")
hist(p_transformed, main = "Distribution of p-values for Transformed Data with Sample Size 50") 
```

```{r}
# n = 100

simulation = 1000 
k = 0.4
n = 100
X1 = c(rep(1, n/2), rep(0, n/2))
X2 = c(rep(0, n/2), rep(1, n/2))
A = matrix(c(X1, X2), nrow = n, ncol=2) 
p_original = vector(length = simulation)
error_original_005 = NA
error_original_001 = NA
error_original_0001 = NA
p_transformed = vector(length = simulation)
error_transformed_005 = NA
error_transformed_001 = NA
error_transformed_0001 = NA

for(i in 1 : simulation){
  original = rweibull(n, shape = 1, scale = 0.5)
  fit_original = lm(formula = original ~ A) 
  p_original[i] = summary(fit_original)$coefficients[2,4]
  if (p_original[i] < 0.05) {
    error_original_005[i] = 1
  }
  if (p_original[i] < 0.01) {
    error_original_001[i] = 1
  }
  if (p_original[i] < 0.001) {
    error_original_0001[i] = 1
  }
  transformed = INT_function(original, n, k)
  fit_transformed = lm(formula = transformed ~ A)
  p_transformed[i] = summary(fit_transformed)$coefficients[2,4]
  if (p_transformed[i] < 0.05) {
    error_transformed_005[i] = 1
  }
  if (p_transformed[i] < 0.01) {
    error_transformed_001[i] = 1
  }
  if (p_transformed[i] < 0.001) {
    error_transformed_0001[i] = 1
  }
}
table(error_original_005)
table(error_original_001)
table(error_original_0001)
table(error_transformed_005)
table(error_transformed_001)
table(error_transformed_0001)
hist(p_original, main = "Distribution of p-values for Original Data with Sample Size 100")
hist(p_transformed, main = "Distribution of p-values for Transformed Data with Sample Size 100") 
```

## Rayleigh Distribution
### Use the given matrix to fit the data generated from Rayleigh distribution. Using 0.05, 0.01, and 0.001 as significance levels and test for sample size 20, 50, and 100 respectively.
```{r}
# n = 20

simulation = 1000 
k = 0.4
n = 20
X1 = c(rep(1, n/2), rep(0, n/2))
X2 = c(rep(0, n/2), rep(1, n/2))
A = matrix(c(X1, X2), nrow = n, ncol=2) 
p_original = vector(length = simulation)
error_original_005 = NA
error_original_001 = NA
error_original_0001 = NA
p_transformed = vector(length = simulation)
error_transformed_005 = NA
error_transformed_001 = NA
error_transformed_0001 = NA

for(i in 1 : simulation){
  original = rrayleigh(n, scale = 1)
  fit_original = lm(formula = original ~ A) 
  p_original[i] = summary(fit_original)$coefficients[2,4]
  if (p_original[i] < 0.05) {
    error_original_005[i] = 1
  }
  if (p_original[i] < 0.01) {
    error_original_001[i] = 1
  }
  if (p_original[i] < 0.001) {
    error_original_0001[i] = 1
  }
  transformed = INT_function(original, n, k)
  fit_transformed = lm(formula = transformed ~ A)
  p_transformed[i] = summary(fit_transformed)$coefficients[2,4]
  if (p_transformed[i] < 0.05) {
    error_transformed_005[i] = 1
  }
  if (p_transformed[i] < 0.01) {
    error_transformed_001[i] = 1
  }
  if (p_transformed[i] < 0.001) {
    error_transformed_0001[i] = 1
  }
}
table(error_original_005)
table(error_original_001)
table(error_original_0001)
table(error_transformed_005)
table(error_transformed_001)
table(error_transformed_0001)
hist(p_original, main = "Distribution of p-values for Original Data with Sample Size 20")
hist(p_transformed, main = "Distribution of p-values for Transformed Data with Sample Size 20") 
```

```{r}
# n = 50

simulation = 1000 
k = 0.4
n = 50
X1 = c(rep(1, n/2), rep(0, n/2))
X2 = c(rep(0, n/2), rep(1, n/2))
A = matrix(c(X1, X2), nrow = n, ncol=2) 
p_original = vector(length = simulation)
error_original_005 = NA
error_original_001 = NA
error_original_0001 = NA
p_transformed = vector(length = simulation)
error_transformed_005 = NA
error_transformed_001 = NA
error_transformed_0001 = NA

for(i in 1 : simulation){
  original = rrayleigh(n, scale = 1)
  fit_original = lm(formula = original ~ A) 
  p_original[i] = summary(fit_original)$coefficients[2,4]
  if (p_original[i] < 0.05) {
    error_original_005[i] = 1
  }
  if (p_original[i] < 0.01) {
    error_original_001[i] = 1
  }
  if (p_original[i] < 0.001) {
    error_original_0001[i] = 1
  }
  transformed = INT_function(original, n, k)
  fit_transformed = lm(formula = transformed ~ A)
  p_transformed[i] = summary(fit_transformed)$coefficients[2,4]
  if (p_transformed[i] < 0.05) {
    error_transformed_005[i] = 1
  }
  if (p_transformed[i] < 0.01) {
    error_transformed_001[i] = 1
  }
  if (p_transformed[i] < 0.001) {
    error_transformed_0001[i] = 1
  }
}
table(error_original_005)
table(error_original_001)
table(error_original_0001)
table(error_transformed_005)
table(error_transformed_001)
table(error_transformed_0001)
hist(p_original, main = "Distribution of p-values for Original Data with Sample Size 50")
hist(p_transformed, main = "Distribution of p-values for Transformed Data with Sample Size 50") 
```

```{r}
# n = 100

simulation = 1000 
k = 0.4
n = 100
X1 = c(rep(1, n/2), rep(0, n/2))
X2 = c(rep(0, n/2), rep(1, n/2))
A = matrix(c(X1, X2), nrow = n, ncol=2) 
p_original = vector(length = simulation)
error_original_005 = NA
error_original_001 = NA
error_original_0001 = NA
p_transformed = vector(length = simulation)
error_transformed_005 = NA
error_transformed_001 = NA
error_transformed_0001 = NA

for(i in 1 : simulation){
  original = rrayleigh(n, scale = 1)
  fit_original = lm(formula = original ~ A) 
  p_original[i] = summary(fit_original)$coefficients[2,4]
  if (p_original[i] < 0.05) {
    error_original_005[i] = 1
  }
  if (p_original[i] < 0.01) {
    error_original_001[i] = 1
  }
  if (p_original[i] < 0.001) {
    error_original_0001[i] = 1
  }
  transformed = INT_function(original, n, k)
  fit_transformed = lm(formula = transformed ~ A)
  p_transformed[i] = summary(fit_transformed)$coefficients[2,4]
  if (p_transformed[i] < 0.05) {
    error_transformed_005[i] = 1
  }
  if (p_transformed[i] < 0.01) {
    error_transformed_001[i] = 1
  }
  if (p_transformed[i] < 0.001) {
    error_transformed_0001[i] = 1
  }
}
table(error_original_005)
table(error_original_001)
table(error_original_0001)
table(error_transformed_005)
table(error_transformed_001)
table(error_transformed_0001)
hist(p_original, main = "Distribution of p-values for Original Data with Sample Size 100")
hist(p_transformed, main = "Distribution of p-values for Transformed Data with Sample Size 100") 
```
